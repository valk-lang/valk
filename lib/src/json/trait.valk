
trait json_encode {
    fn json_value() Value {
        let i = map[Value]{}
        #loop properties this as prop, PT
        i.set(prop.name, prop.value.json_value())
        #end
        return i
    }
    fn json_encode(pretty: bool (false)) {
        return this.json_value().encode(pretty)
    }
}

extend KeyMap[K, V] {
    // #if is_type_of_class(K, String)
    // #if is_type_of_class(V, String)
    // use json_encode
    // #end
    // #end
}