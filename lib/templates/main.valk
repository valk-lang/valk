
use valk:gc
use valk:coro

fn __valk_main__() i32 $entrance $parse_last {
    gc:GcShared.init()
    let gc = gc:GcLocal.init()
    
    @allocas

    #loop classes T
    @pool(T) = gc:Pool.init[T]()
    #end

    #loop globals G T
    #if !@global_is_shared(G)
    G = @global_default_value(G)
    #if @is_gc_type(T)
    gc.add_global(@ref(G))
    #end
    #end
    #end

    co main()
    coro:Coro.loop()

    gc.shutdown()
    return 0
}
